<rss xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title>ipv6 - æ ‡ç­¾ - zu1k</title><link>https://lgf.im/tags/ipv6/</link><description>ipv6 - æ ‡ç­¾ - zu1k</description><generator>Hugo -- gohugo.io</generator><managingEditor>i@lgf.im (zu1k)</managingEditor><webMaster>i@lgf.im (zu1k)</webMaster><copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright><lastBuildDate>Sat, 31 Aug 2019 14:39:03 +0000</lastBuildDate><atom:link href="https://lgf.im/tags/ipv6/" rel="self" type="application/rss+xml"/><item><title>ç»™dockeré‡Œçš„æ¯ä¸€ä¸ªå®¹å™¨ä¸€ä¸ªç‹¬ç«‹çš„ipv6åœ°å€</title><link>https://lgf.im/posts/coding/set-ipv6-for-every-docker-container/</link><pubDate>Sat, 31 Aug 2019 14:39:03 +0000</pubDate><author>ä½œè€…</author><guid>https://lgf.im/posts/coding/set-ipv6-for-every-docker-container/</guid><description><![CDATA[<p>ipv6ä¸æ–­æ™®åŠï¼Œipv6åœ°å€å¤šçš„æ•°ä¸èƒœæ•°ï¼Œæœºæˆ¿ç»™å•å°æœºå™¨åˆ†é…çš„ipv6æ®µè¾¾åˆ°äº†å¯æ€•çš„64ä½é•¿åº¦çš„å­ç½‘ä¸»æœºå·ã€‚</p>
<p>é‚£æˆ‘ä¸ç¦åœ¨æƒ³ï¼Œèƒ½ä¸èƒ½ç»™dockerä¸‹çš„æ¯ä¸ªå®¹å™¨ç‹¬ç«‹çš„ipv6åœ°å€ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ˜ å°„ç«¯å£å·äº†ã€‚</p>
<p>æ‰€ä»¥å°±æœ‰äº†ä»¥ä¸‹å®è·µï¼š</p>
<p>é¦–å…ˆï¼Œç»™docker engineå¼€å¯ipv6æ”¯æŒ, å‚è€ƒï¼š <a href="https://docs.docker.com/config/daemon/ipv6/">https://docs.docker.com/config/daemon/ipv6/</a></p>
<p>é…ç½®/etc/docker/daemon.jsonæ–‡ä»¶å¦‚ä¸‹ã€‚</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-json" data-lang="json"><span class="p">{</span>
    <span class="nt">&#34;ipv6&#34;</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nt">&#34;fixed-cidr-v6&#34;</span><span class="p">:</span> <span class="s2">&#34;2001ğŸ”¢5001ğŸ”¢:/64&#34;</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><p>æ‰§è¡Œ <code>systemctl reload docker</code> é‡è½½Docker Engineçš„é…ç½®æ–‡ä»¶</p>
<p>è¿™æ ·dockeré»˜è®¤çš„bridgeç½‘ç»œå°±ä¼šç»™å®¹å™¨åˆ†é…éšæœºçš„ipv6åœ°å€äº†ã€‚</p>
<p>ä½†æ˜¯æˆ‘ä»¬é€šå¸¸éœ€è¦å›ºå®šçš„ipv6åœ°å€ï¼Œæ‰€ä»¥éœ€è¦æ·»åŠ è‡ªå®šä¹‰ç½‘æ¡¥ç½‘ç»œ</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker network create <span class="se">\
</span><span class="se"></span>    -d bridge --ipv6 <span class="se">\
</span><span class="se"></span>    --subnet <span class="s2">&#34;2001ğŸ”¢5001ğŸ”¢6666::/80&#34;</span> <span class="se">\
</span><span class="se"></span>    --gateway<span class="o">=</span><span class="s2">&#34;2001ğŸ”¢5001ğŸ”¢6666::1&#34;</span> <span class="se">\
</span><span class="se"></span>    --subnet<span class="o">=</span>172.28.0.0/16 <span class="se">\
</span><span class="se"></span>    --gateway<span class="o">=</span>172.28.0.1 ipv6
</code></pre></td></tr></table>
</div>
</div><p>ç„¶åå¯åŠ¨dockerå®¹å™¨æ—¶å€™æŒ‡å®šipv6ç½‘æ¡¥å’Œipv6åœ°å€</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">docker run -itd -P --ip<span class="o">=</span>172.28.0.101 <span class="se">\
</span><span class="se"></span>    --ip6<span class="o">=</span><span class="s2">&#34;2001ğŸ”¢5001ğŸ”¢6666::101&#34;</span> <span class="se">\
</span><span class="se"></span>    --network<span class="o">=</span>ipv6 <span class="se">\
</span><span class="se"></span>    --name<span class="o">=</span>ipv6test <span class="se">\
</span><span class="se"></span>    ubuntu:18.04 /bin/bash
</code></pre></td></tr></table>
</div>
</div><p>æ­¤æ—¶å®¹å™¨å·²ç»æœ‰ç‹¬ç«‹çš„ipv6åœ°å€äº†ï¼Œæˆ‘ä»¬å‘ç°å‘å¤–è®¿é—®å¯ä»¥è®¿é—®ï¼Œä½†æ˜¯å¤–ç•Œè®¿é—®ä¸åˆ°dockeråé¢éšè—çš„container
è¿™æ˜¯å› ä¸ºipv6ä½¿ç”¨NDPåè®®ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å®¹å™¨çš„å®¿ä¸»æœºä¸Šè®¾ç½® ndpä»£ç†</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sysctl net.ipv6.conf.ens3.proxy_ndp<span class="o">=</span><span class="m">1</span>
</code></pre></td></tr></table>
</div>
</div><blockquote>
<p>ens3æ˜¯æˆ‘çš„å®¿ä¸»æœºå¤–ç½‘ç½‘å¡ï¼Œè¿™é‡Œéœ€è¦æ›¿æ¢æˆä½ è‡ªå·±çš„</p>
</blockquote>
<p>è¿™é‡Œæ¯ä¸€ä¸ªdockeråˆ†é…çš„ipv6åœ°å€éƒ½éœ€è¦æ·»åŠ è¿™æ ·ä¸€æ¡è§„åˆ™</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">ip -6 neigh add proxy 2001ğŸ”¢5001ğŸ”¢6666::101 dev ens3
</code></pre></td></tr></table>
</div>
</div>]]></description></item></channel></rss>